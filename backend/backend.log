INFO:     Will watch for changes in these directories: ['/home/duo/work/DL/btl/backend']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [386026] using WatchFiles
/home/duo/work/DL/btl/graph_rag_gemini.py:4: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
INFO:     Started server process [386029]
INFO:     Waiting for application startup.
/home/duo/work/DL/btl/backend/main.py:51: LangChainDeprecationWarning: The class `Neo4jGraph` was deprecated in LangChain 0.3.8 and will be removed in 1.0. An updated version of the class exists in the `langchain-neo4j package and should be used instead. To use it run `pip install -U `langchain-neo4j` and import as `from `langchain_neo4j import Neo4jGraph``.
  graph = Neo4jGraph(
Invalid model-index. Not loading eval results into CardData.
Invalid model-index. Not loading eval results into CardData.
Invalid model-index. Not loading eval results into CardData.
Invalid model-index. Not loading eval results into CardData.
INFO:     Application startup complete.
Initializing Graph RAG system...
Loading embedding model: truro7/vn-law-embedding
Model loaded! Embedding dimension: 768
Gemini initialized with gemini-2.5-flash
Graph RAG system initialized successfully!
Initializing Context RAG system...
Using device: cuda
Loading embedding model: truro7/vn-law-embedding
Loading ChromaDB from: ../chroma_db
Collection size: 3770
Loading rerank model: huynhdat543/VietNamese_law_rerank
Gemini configured with model: gemini-2.0-flash-exp
Context RAG system initialized successfully!
INFO:     127.0.0.1:59400 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:33496 - "POST /api/rag HTTP/1.1" 500 Internal Server Error
WARNING:  WatchFiles detected changes in 'main.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [386029]
/home/duo/work/DL/btl/graph_rag_gemini.py:4: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
INFO:     Started server process [387975]
INFO:     Waiting for application startup.
/home/duo/work/DL/btl/backend/main.py:52: LangChainDeprecationWarning: The class `Neo4jGraph` was deprecated in LangChain 0.3.8 and will be removed in 1.0. An updated version of the class exists in the `langchain-neo4j package and should be used instead. To use it run `pip install -U `langchain-neo4j` and import as `from `langchain_neo4j import Neo4jGraph``.
  graph = Neo4jGraph(
Invalid model-index. Not loading eval results into CardData.
Invalid model-index. Not loading eval results into CardData.
ERROR:    Traceback (most recent call last):
  File "/home/duo/miniconda3/envs/rag/lib/python3.12/site-packages/starlette/routing.py", line 694, in lifespan
    async with self.lifespan_context(app) as maybe_state:
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/duo/miniconda3/envs/rag/lib/python3.12/site-packages/starlette/routing.py", line 571, in __aenter__
    await self._router.startup()
  File "/home/duo/miniconda3/envs/rag/lib/python3.12/site-packages/starlette/routing.py", line 671, in startup
    await handler()
  File "/home/duo/work/DL/btl/backend/main.py", line 65, in startup_event
    shared_embedding_model = embeddings.embedding_model
                             ^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'EntityEmbeddings' object has no attribute 'embedding_model'. Did you mean: 'embedding_dim'?

ERROR:    Application startup failed. Exiting.
Initializing Graph RAG system...
Loading embedding model: truro7/vn-law-embedding
Model loaded! Embedding dimension: 768
WARNING:  WatchFiles detected changes in 'main.py'. Reloading...
/home/duo/work/DL/btl/graph_rag_gemini.py:4: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
INFO:     Started server process [388663]
INFO:     Waiting for application startup.
/home/duo/work/DL/btl/backend/main.py:52: LangChainDeprecationWarning: The class `Neo4jGraph` was deprecated in LangChain 0.3.8 and will be removed in 1.0. An updated version of the class exists in the `langchain-neo4j package and should be used instead. To use it run `pip install -U `langchain-neo4j` and import as `from `langchain_neo4j import Neo4jGraph``.
  graph = Neo4jGraph(
Invalid model-index. Not loading eval results into CardData.
Invalid model-index. Not loading eval results into CardData.
INFO:     Application startup complete.
Initializing Graph RAG system...
Loading embedding model: truro7/vn-law-embedding
Model loaded! Embedding dimension: 768
Gemini initialized with gemini-2.5-flash
Graph RAG system initialized successfully!
Initializing Context RAG system...
Using device: cuda
Using shared embedding model (already loaded)
Loading ChromaDB from: ../chroma_db
Collection size: 3770
Loading rerank model: huynhdat543/VietNamese_law_rerank
Gemini configured with model: gemini-2.0-flash-exp
Context RAG system initialized successfully!
INFO:     127.0.0.1:59076 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:56414 - "POST /api/rag HTTP/1.1" 500 Internal Server Error
INFO:     127.0.0.1:45040 - "POST /api/rag HTTP/1.1" 500 Internal Server Error
WARNING:  WatchFiles detected changes in 'main.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [388663]
/home/duo/work/DL/btl/graph_rag_gemini.py:4: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
INFO:     Started server process [390835]
INFO:     Waiting for application startup.
/home/duo/work/DL/btl/backend/main.py:52: LangChainDeprecationWarning: The class `Neo4jGraph` was deprecated in LangChain 0.3.8 and will be removed in 1.0. An updated version of the class exists in the `langchain-neo4j package and should be used instead. To use it run `pip install -U `langchain-neo4j` and import as `from `langchain_neo4j import Neo4jGraph``.
  graph = Neo4jGraph(
Invalid model-index. Not loading eval results into CardData.
Invalid model-index. Not loading eval results into CardData.
INFO:     Application startup complete.
Initializing Graph RAG system...
Loading embedding model: truro7/vn-law-embedding
Model loaded! Embedding dimension: 768
Gemini initialized with gemini-2.5-flash
Graph RAG system initialized successfully!
Initializing Context RAG system...
Using device: cuda
Using shared embedding model (already loaded)
Loading ChromaDB from: ../chroma_db
Collection size: 3770
Loading rerank model: huynhdat543/VietNamese_law_rerank
Gemini configured with model: gemini-1.5-flash
Context RAG system initialized successfully!
INFO:     127.0.0.1:38010 - "POST /api/rag HTTP/1.1" 500 Internal Server Error
WARNING:  WatchFiles detected changes in 'main.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [390835]
/home/duo/work/DL/btl/graph_rag_gemini.py:4: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
INFO:     Started server process [391619]
INFO:     Waiting for application startup.
/home/duo/work/DL/btl/backend/main.py:52: LangChainDeprecationWarning: The class `Neo4jGraph` was deprecated in LangChain 0.3.8 and will be removed in 1.0. An updated version of the class exists in the `langchain-neo4j package and should be used instead. To use it run `pip install -U `langchain-neo4j` and import as `from `langchain_neo4j import Neo4jGraph``.
  graph = Neo4jGraph(
Invalid model-index. Not loading eval results into CardData.
Invalid model-index. Not loading eval results into CardData.
INFO:     Application startup complete.
Initializing Graph RAG system...
Loading embedding model: truro7/vn-law-embedding
Model loaded! Embedding dimension: 768
Gemini initialized with gemini-2.5-flash
Graph RAG system initialized successfully!
Initializing Context RAG system...
Using device: cuda
Using shared embedding model (already loaded)
Loading ChromaDB from: ../chroma_db
Collection size: 3770
Loading rerank model: huynhdat543/VietNamese_law_rerank
Gemini configured with model: gemini-1.5-flash
Context RAG system initialized successfully!
INFO:     127.0.0.1:33932 - "GET /api/health HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'main.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [391619]
/home/duo/work/DL/btl/graph_rag_gemini.py:4: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
INFO:     Started server process [392674]
INFO:     Waiting for application startup.
/home/duo/work/DL/btl/backend/main.py:52: LangChainDeprecationWarning: The class `Neo4jGraph` was deprecated in LangChain 0.3.8 and will be removed in 1.0. An updated version of the class exists in the `langchain-neo4j package and should be used instead. To use it run `pip install -U `langchain-neo4j` and import as `from `langchain_neo4j import Neo4jGraph``.
  graph = Neo4jGraph(
Invalid model-index. Not loading eval results into CardData.
Invalid model-index. Not loading eval results into CardData.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'main.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [392674]
/home/duo/work/DL/btl/graph_rag_gemini.py:4: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
INFO:     Started server process [393261]
INFO:     Waiting for application startup.
/home/duo/work/DL/btl/backend/main.py:52: LangChainDeprecationWarning: The class `Neo4jGraph` was deprecated in LangChain 0.3.8 and will be removed in 1.0. An updated version of the class exists in the `langchain-neo4j package and should be used instead. To use it run `pip install -U `langchain-neo4j` and import as `from `langchain_neo4j import Neo4jGraph``.
  graph = Neo4jGraph(
Invalid model-index. Not loading eval results into CardData.
Invalid model-index. Not loading eval results into CardData.
INFO:     Application startup complete.
WARNING:  WatchFiles detected changes in 'main.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [393261]
/home/duo/work/DL/btl/graph_rag_gemini.py:4: FutureWarning: 

All support for the `google.generativeai` package has ended. It will no longer be receiving 
updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
See README for more details:

https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md

  import google.generativeai as genai
INFO:     Started server process [394367]
INFO:     Waiting for application startup.
/home/duo/work/DL/btl/backend/main.py:52: LangChainDeprecationWarning: The class `Neo4jGraph` was deprecated in LangChain 0.3.8 and will be removed in 1.0. An updated version of the class exists in the `langchain-neo4j package and should be used instead. To use it run `pip install -U `langchain-neo4j` and import as `from `langchain_neo4j import Neo4jGraph``.
  graph = Neo4jGraph(
Invalid model-index. Not loading eval results into CardData.
Invalid model-index. Not loading eval results into CardData.
INFO:     Application startup complete.
Initializing Graph RAG system...
Loading embedding model: truro7/vn-law-embedding
Model loaded! Embedding dimension: 768
Gemini initialized with gemini-2.5-flash
Graph RAG system initialized successfully!
Initializing Context RAG system...
Using device: cuda
Using shared embedding model (already loaded)
Loading ChromaDB from: ../chroma_db
Collection size: 3770
Loading rerank model: huynhdat543/VietNamese_law_rerank
Gemini configured with model: gemini-2.5-flash
Context RAG system initialized successfully!
INFO:     127.0.0.1:53130 - "POST /api/rag HTTP/1.1" 200 OK
INFO:     127.0.0.1:43148 - "POST /api/rag HTTP/1.1" 200 OK
INFO:     127.0.0.1:36402 - "POST /api/rag HTTP/1.1" 200 OK
INFO:     127.0.0.1:36508 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:41472 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:41482 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:57854 - "OPTIONS /api/create_new_session HTTP/1.1" 200 OK
INFO:     127.0.0.1:57854 - "POST /api/create_new_session HTTP/1.1" 200 OK
INFO:     127.0.0.1:57854 - "OPTIONS /api/rag HTTP/1.1" 200 OK
INFO:     127.0.0.1:57854 - "POST /api/rag HTTP/1.1" 200 OK
INFO:     127.0.0.1:60132 - "POST /api/rag HTTP/1.1" 200 OK
INFO:     127.0.0.1:51814 - "POST /api/rag HTTP/1.1" 200 OK
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [394367]
INFO:     Stopping reloader process [386026]
/home/duo/miniconda3/envs/rag/lib/python3.12/multiprocessing/resource_tracker.py:279: UserWarning: resource_tracker: There appear to be 4 leaked semaphore objects to clean up at shutdown
  warnings.warn('resource_tracker: There appear to be %d '
